<a [routerLink]="[ '/purchases/vendorlist']" class="float">
  <i class="fa fa-arrow-left my-float"></i>
</a>
<a [routerLink]="[ '/dashboard/dashboard1']" class="float-home">
  <i class="fa fa-home my-float-home"></i>
</a>
<a href="https://rhbussolutions.com/documentation/vendor-card/" target="_blank" class="float-help">
  <button type="button" class="btn btn-secondary float-right disabled">
    <i class="fa fa-info"></i>
    Help</button>
</a>

<div class="row">
  <div class="col-3">
    <div class="card">
      <div class="card-body">
        <div class="col-10">
          <h4 class="card-title m-t-10 text-center  font-weight-bold mb-0 " *ngIf="vendorDetails!={}">
            {{vendorDetails.VendCode}}</h4>
        </div>
        <div class="m-t-30 text-center">
          <hr>
          <div class="row">

            <div class="col-10">
              <img src="assets/images/big/img.png" class="img-circle" width="150" />
            </div>
          </div>
          <hr>
          <div class="row">
            <div class="col-10">
              <label class="font-for-formlable" style="text-align:center" *ngIf="!NameEditMode&&vendorDetails!={}">{{vendorDetails.Name}}</label>
              <dx-text-box class="font-for-formlable " id="test" style="text-align:center" *ngIf="vendorDetails!={}&&NameEditMode==true"
                [(value)]="vendorDetails.Name" (onEnterKey)="onEnterKey($event)" (onValueChanged)="onCustNameChanged($event)"
                placeholder="Enter the Vendor Name">
              </dx-text-box>
            </div>
            <div class="col-2">
              <i class="fa fa-edit" (click)="NameEditMode=true"></i>
            </div>
          </div>
          <div class="row">
            <div class="col-10">
              <ngb-rating [(rate)]="currentRate" max="5">
                <ng-template let-fill="fill">
                  <span class="star" [class.filled]="fill === 100">&#9733;</span>
                </ng-template>
              </ngb-rating>
            </div>
          </div>
        </div>
      </div>
      <div>
        <hr>
      </div>
      <div class="card-body" *ngIf="vendorDetails!={}"> <small class="text-muted">Email address </small>
        <h6>{{ vendorDetails.Email }}</h6> <small class="text-muted p-t-30 db">Phone</small>
        <h6>{{ vendorDetails.Phone }}</h6> <small class="text-muted p-t-30 db">Address</small>
        <h6>{{ vendorDetails.Address1 }}, {{ vendorDetails.Address2 }}, {{ vendorDetails.Address3 }}</h6>
      </div>
    </div>
  </div>
  <div class="col-9">
    <div class="card">
      <div class="card-body font-for-formlable">
        <ngb-tabset type="pills" (tabChange)="onTabChange($event)">
          <ngb-tab id="VendorDetails" title="Details">
            <ng-template ngbTabContent>
              <div class="row p-t-20">
                <div class="col-12">
                  <dx-form id="VendorDetails" itemType="group" [colCount]="2" [(formData)]="vendorDetails"
                    accept-charset="UTF-8">
                    <dxi-item class="font-for-formlable" dataField="Address1" [colSpan]="2" [label]="{text: 'Address Line 1'}"></dxi-item>
                    <dxi-item class="font-for-formlable" dataField="Address2" [colSpan]="2" [label]="{text: 'Address Line 2'}"></dxi-item>
                    <dxi-item class="font-for-formlable" dataField="City" [label]="{text: 'City'}"></dxi-item>
                    <dxi-item class="font-for-formlable" dataField="ZipCode" editorType="dxNumberBox" [label]="{text: 'Zip'}"></dxi-item>
                    <dxi-item class="font-for-formlable" [template]="'CountryCode'" [label]="{text: 'Country'}">
                    </dxi-item>
                    <dxi-item class="font-for-formlable" [template]="'StateCode'" [label]="{text: 'State'}"></dxi-item>
                    <dxi-item class="font-for-formlable" dataField="BranchID" [label]="{text: 'Branch ID'}">
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="BranchName" [label]="{text: 'Branch Name'}">
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="Phone" [label]="{text: 'Phone'}" [editorOptions]="{ 
                              mask: '',
                              maskRules: phoneRules,
                              useMaskedValue: true,
                              maskInvalidMessage: 'The phone must have a correct phone format eg: +66 0000000000'
                          }">
                      <!-- <dxi-validation-rule type="pattern" [pattern]="phonePattern"
                        message="The phone number must be numeric">
                      </dxi-validation-rule>-->
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="Email" [label]="{text: 'Email'}">
                      <dxi-validation-rule type="email" message="Email is invalid">
                      </dxi-validation-rule>
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="Fax" [editorOptions]="{ 
                      mask: '',
                      maskRules: phoneRules,
                      useMaskedValue: true
                 }">
                      <dxi-validation-rule type="pattern" [pattern]="phonePattern" message="The fax must be numeric">
                      </dxi-validation-rule>
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="Contact" [label]="{text: 'Contact'}">
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="VATID" [label]="{text: 'TAX ID'}"></dxi-item>
                    <dxi-item class="font-for-formlable" dataField="Purchaser" [label]="{text: 'Purchaser'}">
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="LegacyCode" [label]="{text: 'Legacy Code'}">
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="PaymentTerm" [label]="{text: 'Payment Term'}">
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="Active" editorType="dxCheckBox" [editorOptions]="{ text: 'Active'}">
                      <dxo-label [visible]="false">
                      </dxo-label>
                    </dxi-item>
                    <dxi-item class="font-for-formlable" dataField="HO" editorType="dxCheckBox" [editorOptions]="{ text: 'H.O'}">
                      <dxo-label [visible]="false">
                      </dxo-label>
                    </dxi-item>
                    <div *dxTemplate="let data of 'CountryCode'">
                      <dx-select-box [dataSource]="getCountryCodeListAll" [searchEnabled]="true" [displayExpr]="suggestionFormatForCountryCode"
                        valueExpr="countrycode" [minSearchLength]="0" fieldTemplate="field6" [value]="getCountryCodeListAll ? vendorDetails.Country:''"
                        (onValueChanged)="onDefaultDropDownvalueChanged($event,'Country')" hoverStateEnabled="true"
                        [itemTemplate]="hover7">
                        <div *dxTemplate="let itemData1 of 'field6'">
                          <dx-text-box [text]="itemData1 ? itemData1.countrycode:vendorDetails ? vendorDetails.Country:'' "
                            [elementAttr]="{ 'class': 'font-for-formlable' }"></dx-text-box>
                        </div>
                      </dx-select-box>
                    </div>
                    <div *dxTemplate="let data of 'StateCode'">
                      <dx-select-box [dataSource]="getStateCodeListAll" [searchEnabled]="true" [displayExpr]="suggestionFormatForStateCode"
                        valueExpr="Code" [minSearchLength]="0" fieldTemplate="field7" [value]="getStateCodeListAll ? vendorDetails.State:''"
                        (onValueChanged)="onDefaultDropDownvalueChanged($event,'State')" hoverStateEnabled="true"
                        [itemTemplate]="hover8">
                        <div *dxTemplate="let itemData1 of 'field7'">
                          <dx-text-box [text]="itemData1 ? itemData1.Code:vendorDetails ? vendorDetails.State:'' "
                            [elementAttr]="{ 'class': 'font-for-formlable' }"></dx-text-box>
                        </div>
                      </dx-select-box>
                    </div>
                  </dx-form>
                </div>
              </div>
            </ng-template>
          </ngb-tab>
          <ngb-tab id="Attributes" title="Attributes">
            <ng-template ngbTabContent>
              <div class="row p-t-20">
                <div class="col-12">
                  <div id="form-container">
                    <dx-form id="VendorAttributes" (onFieldDataChanged)="formSummary_fieldDataChanged($event)" itemType="group"
                      [colCount]="2" [(formData)]="vendorDetails" accept-charset="UTF-8">
                      <dxi-item cssClass="font-for-formlable" [template]="'vendorGroupTemplate'" [label]="{text: 'Vendor Group'}"></dxi-item>
                      <dxi-item cssClass="font-for-formlable" [template]="'vatBusGroupTemplate'" [label]="{text: 'VAT Bus. Group'}"></dxi-item>
                      <dxi-item cssClass="font-for-formlable" [template]="'whtGroupTemplate'" [label]="{text: 'WHT Bus. Group'}"></dxi-item>
                      <dxi-item cssClass="font-for-formlable" [template]="'vendorTypeTemplate'" [label]="{text: 'Vendor Type'}"></dxi-item>
                      <dxi-item class="font-for-formlable" dataField="CreditLimit" [label]="{text: 'Credit Limit'}">
                      </dxi-item>
                      <div *dxTemplate="let data of 'vendorGroupTemplate'">
                        <dx-select-box #selectBox2 [dataSource]="vendorGroupSuggestions" [searchEnabled]="true"
                          [showClearButton]="true" [displayExpr]="suggestionFormatForVendorGroup" valueExpr="Code"
                          [minSearchLength]="0" fieldTemplate="field2" [value]="vendorGroupSuggestions ? vendorDetails.VendorGroup:''"
                          (onValueChanged)="onVendorGroupChanged($event)" hoverStateEnabled="true" [itemTemplate]="hover2">
                          <div *dxTemplate="let itemData2 of 'field2'">
                            <dx-text-box [text]="itemData2 ? itemData2.Code:vendorDetails ? vendorDetails.VendorGroup:'' "
                              [elementAttr]="{ 'class': 'font-for-formlable' }"></dx-text-box>
                          </div>
                        </dx-select-box>
                      </div>
                      <div *dxTemplate="let data of 'vatBusGroupTemplate'">
                        <dx-select-box #selectBox2 [dataSource]="vatBusGroupSuggestions" [searchEnabled]="true"
                          [showClearButton]="true" [displayExpr]="suggestionFormatForVatGroup" valueExpr="Code"
                          [minSearchLength]="0" fieldTemplate="field2" [value]="vendorDetails ? vendorDetails.VATGroup:''"
                          (onValueChanged)="onVatBusGroupChanged($event)" hoverStateEnabled="true" [itemTemplate]="hover">
                          <div *dxTemplate="let itemData2 of 'field2'">
                            <dx-text-box [text]="itemData2 ? itemData2.Code:vendorDetails ? vendorDetails.VATGroup:'' "
                              [elementAttr]="{ 'class': 'font-for-formlable' }"></dx-text-box>
                          </div>
                        </dx-select-box>
                      </div>
                      <div *dxTemplate="let data of 'whtGroupTemplate'">
                        <dx-select-box #selectBox2 [dataSource]="whtBusGroupSuggestions" [searchEnabled]="true"
                          [showClearButton]="true" [displayExpr]="suggestionFormatForWhtGroup" valueExpr="Code"
                          [minSearchLength]="0" fieldTemplate="field2" [value]="vendorDetails ? vendorDetails.WHTGroup:''"
                          (onValueChanged)="onWHTBusGroupChanged($event)" hoverStateEnabled="true" [itemTemplate]="hover1">
                          <div *dxTemplate="let itemData2 of 'field2'">
                            <dx-text-box [text]="itemData2 ? itemData2.Code:vendorDetails ? vendorDetails.WHTGroup:'' "
                              [elementAttr]="{ 'class': 'font-for-formlable' }"></dx-text-box>
                          </div>
                        </dx-select-box>
                      </div>
                      <div *dxTemplate="let data of 'vendorTypeTemplate'">
                        <dx-select-box #selectBox2 [dataSource]="vendTypeSuggestions" [searchEnabled]="true"
                          [showClearButton]="true" [displayExpr]="suggestionFormatForVendorType" valueExpr="Code"
                          [minSearchLength]="0" fieldTemplate="field2" [value]="vendorDetails ? vendorDetails.VendorType:''"
                          (onValueChanged)="onVendTypeChanged($event)" hoverStateEnabled="true" [itemTemplate]="hover3">
                          <div *dxTemplate="let itemData2 of 'field2'">
                            <dx-text-box [text]="itemData2 ? itemData2.Code:vendorDetails ? vendorDetails.VendorType:'' "
                              [elementAttr]="{ 'class': 'font-for-formlable' }"></dx-text-box>
                          </div>
                        </dx-select-box>
                      </div>
                    </dx-form>
                  </div>
                </div>
              </div>
            </ng-template>
          </ngb-tab>
          <ngb-tab id="APDetails" title="AP Details">
            <ng-template ngbTabContent>
              <div class="row p-t-20">
                <div class="col-12">
                  <dx-data-grid id="gridContainer" [columnAutoWidth]="true" [allowColumnResizing]="true" [dataSource]="dataSource"
                    [showBorders]="true">
                    <dxo-header-filter [visible]="true" [allowSearch]="true"></dxo-header-filter>
                    <dxo-paging [pageSize]="10"></dxo-paging>
                    <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5, 10, 20]" [showInfo]="true">
                    </dxo-pager>
                    <dxi-column dataField="EntryNo"></dxi-column>
                    <dxi-column dataField="DocumentNo"></dxi-column>
                    <dxi-column dataField="DocumentDate"></dxi-column>
                    <dxi-column dataField="PostingDate"></dxi-column>
                    <dxi-column dataField="DueDate"></dxi-column>
                    <dxi-column dataField="DocumentType"></dxi-column>
                    <dxi-column dataField="VendorNo"></dxi-column>
                    <dxi-column dataField="Amount" dataType="number">
                      <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                    </dxi-column>
                    <dxi-column dataField="RemainingAmount" dataType="number">
                      <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                    </dxi-column>
                    <dxi-column dataField="TotalVATAmount" dataType="number">
                      <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                    </dxi-column>
                    <dxi-column dataField="UserID"></dxi-column>
                  </dx-data-grid>
                </div>
              </div>
              <br>
              <div class="row">
                <h4 class="font-weight-bold">Total Outstanding Balance {{data}}</h4>
              </div>
            </ng-template>
          </ngb-tab>
          <ngb-tab id="VendorStats" title="Stats">
            <ng-template ngbTabContent>
              <div class="row p-t-20">
                <div class="col-12">
                  <div class="card">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-8">
                          <div *ngIf="!showDatagridNew" class="piechart">
                            <canvas baseChart height="300px" [data]="pieChartData" [labels]="pieChartLabels"
                              [chartType]="pieChartType">
                            </canvas>
                          </div>
                          <div *ngIf="showDatagridNew">
                            <dx-data-grid [columnAutoWidth]="true" [dataSource]="vendorChartData" [showBorders]="true"
                              [allowColumnReordering]="true" [hoverStateEnabled]="true">
                              <dxo-search-panel [visible]="true"></dxo-search-panel>
                              <dxi-column dataField="LineCode" caption="Code">
                              </dxi-column>
                              <dxi-column dataField="Qty" caption="Amount" dataType="number">
                                <dxo-format type="fixedPoint" [precision]="2">
                                </dxo-format>
                              </dxi-column>
                              <dxi-column dataField="Amt" caption="Amount" dataType="number">
                                <dxo-format type="fixedPoint" [precision]="2">
                                </dxo-format>
                              </dxi-column>
                              <dxo-paging [pageSize]="12"></dxo-paging>
                              <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[8, 12, 20]"></dxo-pager>

                            </dx-data-grid>
                          </div>
                        </div>
                        <div class="col-4">
                          <dx-button icon="menu" type="default" (onClick)="showGridNew()">
                          </dx-button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-template>
          </ngb-tab>
          <ngb-tab id="items" title="Items">
            <ng-template ngbTabContent>
              <div class="row p-t-20">
                <div class="col-12">
                  <dx-data-grid #gridContainer2 id="gridContainer2" [columnAutoWidth]="true" [dataSource]="getVendoritemsdata"
                    [showBorders]="true" [allowColumnReordering]="true" [hoverStateEnabled]="true" (onInitNewRow)="onInitNewRow()">
                    <dxo-search-panel [visible]="true"></dxo-search-panel>
                    <dxo-editing mode="row" [allowAdding]="true" [allowUpdating]="true" [allowDeleting]="true"></dxo-editing>
                    <dxi-column dataField="ItemCode" [allowSearch]="true" dataType="string" [setCellValue]="setBaseUOMValueItemCode"
                      [editorOptions]="{showClearButton: false, itemTemplate: formateForItemListHover, searchExpr: ['ItemCode', 'Description','UOM'] }">
                      <dxo-lookup [dataSource]="itemLookupSuggestionDataGrid" [valueExpr]="formateForItemListHover2"
                        [displayExpr]="formateForItemListHover2" hoverStateEnabled="true">
                      </dxo-lookup>
                    </dxi-column>
                    <dxi-column dataField="Name" [allowEditing]="false" caption="Vendor Name"></dxi-column>
                    <dxi-column dataField="Brand"></dxi-column>
                    <dxi-column dataField="Description"></dxi-column>
                    <dxo-paging [pageSize]="12"></dxo-paging>
                    <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[8, 12, 20]"></dxo-pager>
                  </dx-data-grid>
                </div>
              </div>
            </ng-template>
          </ngb-tab>

          <!-- <ngb-tab id="userDefined" title="User Defined">
            <ng-template ngbTabContent>
              <div class="row p-t-20">
                <div class="col-6">
                  <formio (change)="onChange1($event)" [(form)]=jsonSchema></formio>
                </div>
              </div>
            </ng-template>
          </ngb-tab> -->
        </ngb-tabset>
        <br>
        <div class="row">
          <div class="col-6">
            <dx-button text="Save" type="default" [visible]="visiblity" (onClick)="Save()">
            </dx-button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <dx-popup class="popup" [showTitle]="true" title="Add Items" [dragEnabled]="true" [closeOnOutsideClick]="true"
    [(visible)]="vendorItemAdd" (onHidden)="onHiding($event)">
    <div *dxTemplate="let data of 'content'">
      <div id="form-container">
        <dx-form accept-charset="UTF-8" [formData]="newCustomerDetail" [colCount]="2">
          <dxi-item cssClass="font-for-formlable" [colSpan]="2" [template]="'nameTemplate1'" [label]="{text: 'Line Type'}"></dxi-item>
          <div *dxTemplate="let data of 'nameTemplate1'">
            <dx-select-box [dataSource]="chooseImportFormat" [minSearchLength]="0" [value]="newCustomerDetail ? newCustomerDetail.userselected:''"
              (onValueChanged)="onSuggestionChange($event,'userselected')" [showClearButton]="false">
            </dx-select-box>
          </div>
        </dx-form>
        <br>
        <br>
        <div *ngIf="ItemCodeTemplateItem">
          <dx-form itemType="group" [colCount]="2" accept-charset="UTF-8" [formData]="newCustomerDetail">
            <dxi-item cssClass="font-for-formlable" [colSpan]="2" [template]="'ItemTemplate'" [label]="{text: 'Item Code'}"></dxi-item>
            <dxi-item cssClass="font-for-formlable" [colSpan]="2" dataField="Description"></dxi-item>
            <div *dxTemplate="let data of 'ItemTemplate'">
              <dx-select-box [dataSource]="itemLookupSuggestionDataGrid" [searchEnabled]="true" [showClearButton]="true"
                [displayExpr]="formateForItemListHover2" valueExpr="ItemCode" [minSearchLength]="0" [value]="newCustomerDetail ? newCustomerDetail.ItemCode:''"
                (onValueChanged)="onSuggestionChange($event,'ItemCode')">
              </dx-select-box>
            </div>
          </dx-form>
        </div>
        <div *ngIf="BrandTemplateItem">
          <dx-form itemType="group" [colCount]="2" accept-charset="UTF-8" [formData]="newCustomerDetail">
            <dxi-item cssClass="font-for-formlable" [colSpan]="2" [template]="'BrandTemplate'" [label]="{text: 'Brand Code'}"></dxi-item>
            <div *dxTemplate="let data of 'BrandTemplate'">
              <dx-select-box [dataSource]="brandSuggestions" [searchEnabled]="true" [showClearButton]="true"
                [displayExpr]="suggestionFormatForBrand" valueExpr="BrandCode" [minSearchLength]="0" [value]="newCustomerDetail ? newCustomerDetail.BrandCode:''"
                (onValueChanged)="onSuggestionChange($event,'BrandCode')">
              </dx-select-box>
            </div>
          </dx-form>
        </div>
      </div>
      <br>
      <dx-button text="ADD" type="default" (onClick)="SaveItemInPopup()"></dx-button>
    </div>
  </dx-popup>